<div class="validation">
  <div class="dropdown--edit dropdown--multiselect" role="combobox" [attr.aria-expanded]="expanded" [ngClass]="{'dropdown--open' : expanded, 'dropdown--filter-visible' : filterVisible}"
    (mousedown)="onToggleDropdown($event)" (keydown)="openDropdownKeyEvent($event)" (focusout)="onLeave()" (focusin)="onEnter()"
    tabindex="0">
    <span class="noselect">{{dropdownLabel}}</span>
    <div class="dropdown__menu">
      <vgr-filter-textbox class="dropdown__filterTextbox" (valueChanged)="filterItems($event)"></vgr-filter-textbox>
      <div *ngIf="dimmerTopVisible" class="dropdown__dimmer dropdown__dimmer--top"></div>
      <perfect-scrollbar class="container" [config]="scrollbarConfig">
        <ul class="dropdown__menu__items" role="listbox">
          <!-- om det finns en showAllItem -->
          <li *ngIf="!filterActive" class="dropdown-item--select-all" [ngClass]="{'dropdown-item--marked' : selectAllItemsMarked, 'dropdown-item--selected' : selectAllItemsChecked }">
            <!-- om listan inte är filtrerad -->
            <a (mousedown)="onItemClicked(selectAllItem)" tabindex="0" title="{{selectAllItemText}}" (keydown)="openDropdownSelectAllItemKeyEvent($event, item)"
              (mouseenter)="selectAllItemsMarked = true" (mouseleave)="selectAllItemsMarked = false" (focusin)="selectAllItemsMarked = true"
              (focusout)="selectAllItemsMarked = false">
              <vgr-checkbox class="checkbox--inline" [checked]="selectAllItemsChecked" (checkedChanged)="selectAllItems($event)" [label]="selectAllItemText"></vgr-checkbox>
            </a>
          </li>

          <li *ngIf="filterActive" class="dropdown-item--select-all" [ngClass]="{'dropdown-item--marked' : selectAllItemsMarked}" (keydown)="openDropdownShowAllItemKeyEvent($event, item)">
            <!-- om listan är filtrerad -->
            <a tabindex="0" (mousedown)="clearFilter()" title="{{showAllItemText}}" (mouseenter)="selectAllItemsMarked = true" (mouseleave)="selectAllItemsMarked = false"
              (focusin)="selectAllItemsMarked = true" (focusout)="selectAllItemsMarked = false">{{showAllItemText}}
            </a>
          </li>

          <li *ngFor="let item of items | filterByProperties: filter : ['displayName']" [ngClass]="{'dropdown-item--marked' : item.marked, 'dropdown-item--selected' : item.selected }">
            <a title={{item.displayName}} tabindex="0" (keydown)="openDropdownItemKeyEvent($event, item)" (mousedown)="onItemClicked(item)"
              (mouseenter)="item.marked = true" (mouseleave)="item.marked = false" (focusin)="item.marked = true" (focusout)="item.marked = false">
              <vgr-checkbox class="checkbox--inline" [checked]="item.selected" (checkedChanged)="onItemCheckChanged(item)" [label]="item.displayName"></vgr-checkbox>
            </a>
          </li>
        </ul>
      </perfect-scrollbar>

      <div *ngIf="dimmerBottomVisible" class="dropdown__dimmer dropdown__dimmer--bottom"></div>
    </div>
  </div>
  <div class="validation__status" title="{{validationErrorMessage}}">
    <div class="validation__status__icon"></div>
    <div class="validation__status__message">{{validationErrorMessage | truncate:50}}</div>
  </div>

</div>

<div class="dropdown__multiselect-readonlylist">
  <ul>
    <li *ngFor="let selectedItem of selectedItems">{{selectedItem | dropdownItemToSelectedText}}</li>
  </ul>
</div>
